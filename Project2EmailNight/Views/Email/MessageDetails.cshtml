@model Project2EmailNight.Models.MessageDetailsViewModel

@{
    ViewData["Title"] = "MessageDetails";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-wrapper">
    <div class="page-content-wrapper">
        <div class="page-content">

            <div class="email-wrapper">
                <div class="email-sidebar">
                    <div class="email-sidebar-header d-grid">
                        <a href="javascript:;" class="btn btn-primary compose-mail-btn"><i class='bx bx-plus me-2'></i>Yeni Mesaj</a>
                    </div>
                    <div class="email-sidebar-content">
                        <div class="email-navigation">
                            <h6 class="text-uppercase fw-bold p-3 mb-0 font-12 text-muted">Klasörler</h6>
                            <div class="list-group list-group-flush mb-3">
                                <a href="/Email/SendEmail" class="list-group-item active d-flex align-items-center">
                                    <i class='bx bxs-inbox me-3 font-20'></i><span>Gelen Kutusu</span>
                                    <span class="badge bg-primary rounded-pill ms-auto">7,513</span>
                                </a>
                                <a href="/Email/Starred" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-star me-3 font-20'></i><span>Yıldızlılar</span>
                                </a>
                                <a href="/Email/Sent" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-send me-3 font-20'></i><span>Gidenler</span>
                                </a>
                                <a href="/Email/Drafts" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-file-blank me-3 font-20'></i><span>Taslaklar</span>
                                    <span class="badge bg-warning text-dark rounded-pill ms-auto">4</span>
                                </a>
                                <a href="/Email/Trash" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-trash-alt me-3 font-20'></i><span>Silinenler</span>
                                </a>
                            </div>

                            <h6 class="text-uppercase fw-bold p-3 mb-0 font-12 text-muted">Kategoriler</h6>
                            <div class="list-group list-group-flush">
                                <a href="/Category/WorkCategory" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-circle me-3 font-12 text-danger'></i><span>İş E-postaları</span>
                                </a>
                                <a href="Category/Education" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-circle me-3 font-12 text-success'></i><span>Eğitim E-postaları</span>
                                </a>
                                <a href="Category/Family" class="list-group-item d-flex align-items-center">
                                    <i class='bx bxs-circle me-3 font-12 text-info'></i><span>Aile E-postaları</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Sidebar -->
                <div class="email-sidebar">
                   @*  <div class="email-sidebar-header d-grid">
                        <a href="/Email/SendEmail" class="btn btn-primary">
                            <i class='bx bx-arrow-back me-2'></i>Geri Dön
                        </a>
                    </div> *@
                    <div class="email-sidebar">
                        <div class="email-sidebar-header d-grid">
                            <a href="/Email/SendEmail" class="btn btn-primary">
                                <i class='bx bx-arrow-back me-2'></i>Geri Dön
                            </a>
                        </div> 
                        <div class="email-sidebar-content">
                            <div class="email-navigation">
                                <h6 class="text-uppercase fw-bold p-3 mb-0 font-12 text-muted">Klasörler</h6>
                                <div class="list-group list-group-flush mb-3">
                                    <a href="/Email/SendEmail" class="list-group-item active d-flex align-items-center">
                                        <i class='bx bxs-inbox me-3 font-20'></i><span>Gelen Kutusu</span>
                                        <span class="badge bg-primary rounded-pill ms-auto">7,513</span>
                                    </a>
                                    <a href="/Email/Starred" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-star me-3 font-20'></i><span>Yıldızlılar</span>
                                    </a>
                                    <a href="/Email/Sent" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-send me-3 font-20'></i><span>Gidenler</span>
                                    </a>
                                    <a href="/Email/Drafts" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-file-blank me-3 font-20'></i><span>Taslaklar</span>
                                        <span class="badge bg-warning text-dark rounded-pill ms-auto">4</span>
                                    </a>
                                    <a href="/Email/Trash" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-trash-alt me-3 font-20'></i><span>Silinenler</span>
                                    </a>
                                </div>

                                <h6 class="text-uppercase fw-bold p-3 mb-0 font-12 text-muted">Kategoriler</h6>
                                <div class="list-group list-group-flush">
                                    <a href="/Category/WorkCategory" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-circle me-3 font-12 text-danger'></i><span>İş E-postaları</span>
                                    </a>
                                    <a href="/Category/EducationCategory" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-circle me-3 font-12 text-success'></i><span>Eğitim E-postaları</span>
                                    </a>
                                    <a href="/Category/FamilyCategory" class="list-group-item d-flex align-items-center">
                                        <i class='bx bxs-circle me-3 font-12 text-info'></i><span>Aile E-postaları</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONTENT -->
                <div class="email-content p-4">

                    <div class="card shadow-sm border-0">
                        <div class="card-body d-flex align-items-center">

                            <!-- Yıldız -->
                            <button class="btn btn-light me-2"
                                    onclick="toggleStar(@Model.MessageId)">
                                <i id="starIcon"
                                   class="bx @(Model.IsStarred ? "bxs-star text-warning" : "bx-star text-secondary")">
                                </i>
                            </button>

                            <!-- Sil -->
                            <button class="btn btn-light me-2"
                                    onclick="deleteMessage(@Model.MessageId)">
                                <i class="bx bx-trash text-danger"></i>
                            </button>

                            <!-- Kategori -->
                            <div class="dropdown me-2">
                                <button class="btn btn-light dropdown-toggle"
                                        type="button"
                                        data-bs-toggle="dropdown">
                                    <i class="bx bx-category me-1"></i> Kategori
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item"
                                           href="#"
                                           onclick="setCategory(@Model.MessageId, 1)">
                                            İş E-postaları
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item"
                                           href="#"
                                           onclick="setCategory(@Model.MessageId, 2)">
                                            Eğitim E-postaları
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item"
                                           href="#"
                                           onclick="setCategory(@Model.MessageId, 3)">
                                            Aile E-postaları
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <div class="ms-auto text-muted small">
                                @Model.SendDate.ToString("dd MMM yyyy HH:mm")
                            </div>

                        </div>
                        <!-- Header -->
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-1">@Model.Subject</h5>
                            <small class="text-muted">
                                Gönderen: @Model.SenderEmail |
                                Tarih: @Model.SendDate.ToString("dd.MM.yyyy HH:mm")
                            </small>
                        </div>

                        <!-- Body -->
                        <div class="card-body">

                            <div class="message-content">
                                @Html.Raw(Model.MessageDetail)
                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>
    </div>
</div>


<script>
    function toggleStar(id) {

        fetch('/Email/ToggleStar/' + id, {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const icon = document.getElementById("starIcon");

                if (data.isStarred) {
                    icon.classList.remove("bx-star", "text-secondary");
                    icon.classList.add("bxs-star", "text-warning");
                } else {
                    icon.classList.remove("bxs-star", "text-warning");
                    icon.classList.add("bx-star", "text-secondary");
                }
            }
        });
    }

    function deleteMessage(id) {

        fetch('/Email/Delete/' + id, {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                window.location.href = '/Email/SendEmail';
            }
        });
    }

    function setCategory(id, categoryId) {

        fetch('/Email/SetCategory?id=' + id + '&categoryId=' + categoryId, {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("Kategori güncellendi");
            }
        });
    }
</script>

<style>
    .card-body button {
        transition: all 0.2s ease;
    }

        .card-body button:hover {
            transform: scale(1.05);
            background-color: #f1f3f9;
        }

    .dropdown-menu {
        border-radius: 12px;
    }
</style>


<style>
    .message-content {
        line-height: 1.8;
        font-size: 15px;
    }

    .card {
        border-radius: 14px;
    }
</style>


